<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<link rel="icon" type="image/x-icon" href="/Logo.png">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PalAntojo</title>
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="VerDetalles.css">
	<!-- AGREGAR SWEETALERT2 -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

	<!-- NAVBAR -->
	<nav class="navbar navbar-expand-lg navbar-custom">
		<div class="container-fluid d-flex align-items-center justify-content-between">
			<div class="d-flex align-items-center">
				<a href="/PaginaPrincipal/PaginaPrincipal.html" title="PalAntojo">
					<img src="/Logo.png" alt="Logo" class="logo">
				</a>
				<div class="d-flex align-items-center user-info">
					<a href="/Perfil/Perfil.html" title="Perfil de usuario">
						<img id="fotoNavbar" src="/Imagenes/default.png" alt="Foto de perfil"
							class="logo">
					</a>
					<span class="username" id="nombreNavbar">@nombreUsuario</span>
				</div>
			</div>

			<form id="searchForm" class="form-inline search-bar">
				<input id="searchInput" class="form-control" type="search" placeholder="Buscar..."
					aria-label="Search">
				<button class="btn btn-search" type="submit"><i class="bi bi-search"
						id="buscar"></i></button>
			</form>

			<div class="d-flex align-items-center icon-group">
				<a href="/CrearEditarPublicacion/CrearEditarPublicacion.html" class="btn-publish"
					title="Publicar receta">
					<i class="bi bi-plus-circle-fill" id="publicar"></i>
				</a>

				<a href="/InicioSesion/InicioSesion.html" class="btn-logout" title="Cerrar sesión">
					<i class="bi bi-box-arrow-right" id="logout"></i>
				</a>
			</div>
		</div>
	</nav>

	<!--..............RECETA.............-->
	<div class="container mt-5">

		<div class="receta-card">
			<div class="receta-info">
				<img src="/Imagenes/Tacos.jpg" alt="#" class="receta-img">

				<div class="receta-detalles">
					<h3>Tacos</h3>
					<p><strong>Receta publicada por:</strong> Carlos Fuentes
						<small class="text-muted">(@carlitos)</small>
					</p>
					<p><strong>Estado: </strong> Nuevo León</p>
					<p><strong>Descripción: </strong>Tacos caseros</p>

					<h5>Ingredientes</h5>
					<ul>
						<li>Carne</li>
						<li>Tortillas</li>
						<li>Salsa</li>
					</ul>

					<h5>Instrucciones</h5>
					<ol>
						<li>Cocer la carne</li>
						<li>Calentar tortillas</li>
					</ol>

					<!-- BOTÓN GUARDAR RECETA CON ALERT - AGREGAR ID -->
					<button class="btn-guardar-receta" id="btnGuardarReceta">Guardar receta</button>
				</div>
			</div>
		</div>

		<!--.......OPINIONES..........-->
		<div class="opinion-card">
			<h5>Calificar:</h5>
			<div class="stars">★ ★ ★ ★ ☆</div>

			<!-- AGREGAR ID AL TEXTAREA -->
			<textarea class="form-control mt-2" placeholder="Añadir comentario..."
				id="comentarioTexto"></textarea>

			<!-- BOTÓN COMENTAR CON ALERT - AGREGAR ID -->
			<button class="btn-comentar" id="btnComentar">Comentar</button>

			<h4 class="mt-4">Opiniones</h4>
			<hr>
			<div class="comentario">
				<img src="/Imagenes/default.png" alt="foto de usuario" class="comentario-img">
				<div class="comentario-texto">
					<p class="comentario-usuario">
						<strong>Roberto</strong> <small>@roberto11</small>
					</p>
					<p class="comentario-contenido">No está chida</p>
				</div>
			</div>

			<div class="comentario">
				<img src="/Imagenes/default.png" alt="foto de usuario" class="comentario-img">
				<div class="comentario-texto">
					<p class="comentario-usuario">
						<strong>Agustín</strong> <small>@gussss</small>
					</p>
					<p class="comentario-contenido">Es lo mejor que probé en mi vida</p>
				</div>
			</div>

		</div>
	</div>

	<footer>
		© 2025, PalAntojo
	</footer>

	<script>
		const user = JSON.parse(sessionStorage.getItem("user"));
		if (!user) {
			window.location.href = "/InicioSesion/InicioSesion.html";
		} else {
			document.getElementById("nombreNavbar").textContent = user.username ? "@" + user.username : "@nombreUsuario";
			document.getElementById("fotoNavbar").src = user.fotoPerfil || "/Imagenes/default.png";

			// Busqueda
			const searchForm = document.getElementById("searchForm");
			const searchInput = document.getElementById("searchInput");
			if (searchForm) {
				searchForm.addEventListener("submit", (e) => {
					e.preventDefault();
					const query = searchInput.value.trim();
					if (!query) return;
					window.location.href = `/PaginaPrincipal/PaginaPrincipal.html?q=${encodeURIComponent(query)}`;
				});
			}
		}

		// ========== DEBUG: Verificar que los elementos existen ==========
		console.log('Elemento btnGuardarReceta:', document.getElementById('btnGuardarReceta'));
		console.log('Elemento btnComentar:', document.getElementById('btnComentar'));
		console.log('Elemento comentarioTexto:', document.getElementById('comentarioTexto'));

		// ========== ALERT PARA GUARDAR RECETA ==========
		const btnGuardar = document.getElementById('btnGuardarReceta');
		if (btnGuardar) {
			btnGuardar.addEventListener('click', function () {
				console.log('Botón Guardar clickeado');
				Swal.fire({
					title: '¿Guardar receta?',
					text: 'Esta receta se agregará a tus recetas guardadas',
					icon: 'question',
					showCancelButton: true,
					confirmButtonColor: '#da2627',
					cancelButtonColor: '#6c757d',
					confirmButtonText: 'Sí, guardar',
					cancelButtonText: 'Cancelar'
				}).then((result) => {
					if (result.isConfirmed) {
						// Aquí iría la lógica para guardar la receta
						Swal.fire({
							title: '¡Guardada!',
							text: 'La receta ha sido agregada a tus favoritos',
							icon: 'success',
							confirmButtonColor: '#da2627',
							timer: 2000
						});
					}
				});
			});
		} else {
			console.error('No se encontró el botón btnGuardarReceta');
		}

		// ========== ALERT PARA COMENTAR ==========
		const btnComentar = document.getElementById('btnComentar');
		if (btnComentar) {
			btnComentar.addEventListener('click', function () {
				console.log('Botón Comentar clickeado');
				const comentario = document.getElementById('comentarioTexto').value.trim();

				if (!comentario) {
					Swal.fire({
						title: 'Comentario vacío',
						text: 'Por favor escribe un comentario antes de publicar',
						icon: 'warning',
						confirmButtonColor: '#da2627'
					});
					return;
				}

				Swal.fire({
					title: '¿Publicar comentario?',
					text: 'Tu comentario será visible para todos los usuarios',
					icon: 'question',
					showCancelButton: true,
					confirmButtonColor: '#da2627',
					cancelButtonColor: '#6c757d',
					confirmButtonText: 'Sí, publicar',
					cancelButtonText: 'Cancelar'
				}).then((result) => {
					if (result.isConfirmed) {
						// Aquí iría la lógica para guardar el comentario
						Swal.fire({
							title: '¡Comentario publicado!',
							text: 'Tu opinión ha sido compartida con la comunidad',
							icon: 'success',
							confirmButtonColor: '#da2627',
							timer: 2000
						}).then(() => {
							// Limpiar el textarea después de publicar
							document.getElementById('comentarioTexto').value = '';
						});
					}
				});
			});
		} else {
			console.error('No se encontró el botón btnComentar');
		}

		// ========== AGREGAR EVENT LISTENER AL CARGAR LA PÁGINA ==========
		document.addEventListener('DOMContentLoaded', function () {
			console.log('Página cargada, verificando elementos...');

			// Verificar nuevamente después de que cargue todo
			setTimeout(() => {
				console.log('Elementos después de carga completa:');
				console.log('btnGuardarReceta:', document.getElementById('btnGuardarReceta'));
				console.log('btnComentar:', document.getElementById('btnComentar'));
			}, 100);
		});
	</script>
</body>

</html>
